<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HAProxy 可以處理多少同時連線？</title>
  <meta name="description" content="請注意：本文並「非」專門針對 OpenStack Neutron LBaaS，而只談在執行實例內執行的 HAProxy。最近，我一直在查看客戶的負載平衡配置。檢查客戶的 HAProxy 狀態頁面時，想到一個問題：「它們到底可以支援多少同時連線？」每個後端伺服器的連線數上限很重要嗎？本文提供一種方法，讓您可以判定 ...">

  <link rel="stylesheet" href="/help-documentation/css/main.css">
  <link rel="canonical" href="/help-documentation/zh_TW/troubleshooting/How_many_connections_can_HAProxy_handle/">
  <link rel="alternate" type="application/rss+xml" title="Blue Box Help" href="/help-documentation/zh_TW/feed.xml">
  
  <style>
   .site-header img:first-child {
       height: 72px;
}
</style>
  
</head>


  <body>

  
    <header class="site-header">

  <div class="header-wrapper">

    <a class="site-title" href="/help-documentation/zh_TW/"><img src="/help-documentation/img/zh_TW/Bluemix-logo-UI.svg" alt="" height="72px"></a>

    <div class="search--pageview">

  <div class="full-view__search hide">
    <a href="" class="x hide">X</a>
    <ul id="results-container"></ul>
    <ul class="results--container"></ul>

  </div>
  <div class="input-container">
    <label for="search__fullview" class="hide search--label">Search IBM Bluemix Private Cloud Help</label>
    <input type="text" id="search-input" placeholder="" name="search" class="search__minview--page">
    <img src="/help-documentation/img/zh_TW/search.svg" class="search-icon" />
  </div>
</div>


    <a href="mailto:llundquist@us.ibm.com" class="header--request">
      <p>
        Submit A Request
      </p>
      <img src="/help-documentation/img/zh_TW/user.svg">
    </a>
    <a id="nav-toggle" href="#"><span></span></a>

    <div>
  
    
      <a  href=" /help-documentation/troubleshooting/How_many_connections_can_HAProxy_handle/ ">en</a> |
    
      <a  href=" /help-documentation/fr/troubleshooting/How_many_connections_can_HAProxy_handle/ ">fr</a> |
    
      <a  href=" /help-documentation/de/troubleshooting/How_many_connections_can_HAProxy_handle/ ">de</a> |
    
      <a  href=" /help-documentation/ja/troubleshooting/How_many_connections_can_HAProxy_handle/ ">ja</a> |
    
      <a  href=" /help-documentation/zh_CN/troubleshooting/How_many_connections_can_HAProxy_handle/ ">zh_CN</a> |
    
      <a style="font-weight: bold;" href=" /help-documentation/zh_TW/troubleshooting/How_many_connections_can_HAProxy_handle/ ">zh_TW</a> |
    
      <a  href=" /help-documentation/pt_BR/troubleshooting/How_many_connections_can_HAProxy_handle/ ">pt_BR</a> |
    
  
</div>

  </div>

</header>

  

  
  <div class="page-content">
  

      <div class="main-wrapper">
        
<div class="sidebar sidebar--toggled">
  <ul class="sidebar__nav">
    <li>
      <h3 class="title">
        
        
        
        <a  class="page-link"  href="/help-documentation/zh_TW/gettingstarted">Getting Started (41)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">Common Technical Questions</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/connect-to-openvpn-server/">連接至 OpenVPN 伺服器</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/openvpn-setup/">在執行實例上設定 OpenVPN 伺服器</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Customer_3.1.1_Point_Release/">Notas sobre a liberação do ponto 3.1.1 para cliente</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/blue-box-cloud-components/">Bluemix Private Cloud 元件</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/detaching-volume/">分離磁區之前我應該做什麼？</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Customer_3.1.0_Release_Notes/">Notas sobre a liberação 3.1.0</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Customer_4.0.0.0r_Release_Notes/">Notas sobre a liberação 4.0.0.0r</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/FAQ/">技術常見問題</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/python-environment-primer/">虛擬 Python 環境與您：開發人員的開始使用書</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/RHOSP_Product_Overview/">IBM Bluemix Private Cloud with Red Hat - 產品概觀</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Building_Blocks/">IBM Bluemix Private Cloud 建置區塊（社群版）</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/RHOSP_Building_Blocks/">為 IBM Bluemix Private Cloud with Red Hat 建置區塊</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/general_product_overview/">一般產品概觀</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Instance_Resize/">調整執行實例大小（非即時）</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Connecting_Clouds_with_SoftLayer/">使用私有網路設定多個雲端環境之間的網路連線功能</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commontech/Windows_License_Activation/">Windows 啟動客戶手冊</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 9 )</a></li>
      </ul>
      
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">Common Administrative Questions</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commonadmin/view-my-bill/">如何檢視我的帳單？</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commonadmin/adding-removing-subscribers/">新增或移除問題單的訂閱者</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commonadmin/report-issue/">如何報告問題？</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commonadmin/escalating-a-ticket/">如何呈報問題單？</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commonadmin/status-pages/">Bluemix Private Cloud 狀態頁面</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/commonadmin/Transferring_A_Domain_From_Blue_Box/">透過 Blue Box 轉移網域</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 2 )</a></li>
      </ul>
      
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">User Guides</h5>
        
        
          
             
         
             
         
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Box_Panel/">Box Panel 使用手冊</a>
                  </li>
              
             
         
             
                <li>
                <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Eternal_Blue-ish_Triangle/">Box Panel、網站控制器及 IBM Bluemix Private Cloud（本端）</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/qemu_article/">淺談 OpenStack — QEMU 與您的雲端</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Improving_Cloud_Performance/">淺談 OpenStack II -- 增進雲端效能</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Optimized_Load_Balancing/">雲端 101 -- 最佳化負載平衡</a>
                </li>
              
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Cloud_Images_Provided_by_IBM/">雲端映像檔的使用手冊（社群版）</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Cloud_Images_Provided_RHOSP/">雲端映像檔的使用手冊 (IBM Bluemix Private Cloud with Red Hat)</a>
                  </li>
              
             
         
             
         
             
         
             
         
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/gettingstarted/userguides/Image_Release_Notes/">IBM Bluemix Private Cloud 映像檔版本注意事項</a>
                  </li>
              
             
         
        <li><a href="" class="page-link view">View More ( 4 )</a></li>
      </ul>
      
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">Release Notes</h5>
        
        
          
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_3.1.1_Point_Release/">客戶 3.1.1 版本注意事項</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_3.0.1_Point_Release/">客戶 3.0.1 版本注意事項</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_4.0.0.0c_Release_Notes/">Release Notes 4.0.0.0c</a>
                  </li>
              
             
         
             
                <li>
                <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_2.1.1_Point_Release/">版本注意事項 2.1.1</a>
                </li>
              
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_3.1.0_Release_Notes/">版本注意事項 3.1.0</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_3.0.0_Release_Notes/">版本注意事項 3.0.0</a>
                  </li>
              
             
         
             
                <li>
                <a class="page-link" href="/help-documentation/zh_TW/releasenotes/Customer_4.0.0.0r_Release_Notes/">版本注意事項 4.0.0.0r</a>
                </li>
              
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/zh_TW/releasenotes/release_notes_2.1_for_customers/">版本注意事項 2.1</a>
                  </li>
              
             
         
        <li><a href="" class="page-link view">View More ( 6 )</a></li>
      </ul>
    </li>
    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/troubleshooting">Troubleshooting (19)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/ssh-too-long-error/">為何需要 4-5 秒的時間才能透過 SSH 連上我的執行實例？</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/ping-instance-error/">為何無法透過 SSH 連上執行實例或 ping 它？</a>
          </li>
          
        
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/nova-microversions-error/">錯誤：執行 Nova 指令時，發生「伺服器不支援微型版本」</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/libvirt_error/">執行實例處於錯誤狀態：libvirt 錯誤</a>
          </li>
          
        
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/Bad_Availability_Zone/">Cloud Foundry：無效可用性區域錯誤</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link--active"  href="/help-documentation/zh_TW/troubleshooting/How_many_connections_can_HAProxy_handle/">HAProxy 可以處理多少同時連線？</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/failed_to_create_router/">嘗試建立路由器失敗</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/failure_prepping_block_device/">錯誤：準備區塊裝置時失敗</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/CLI-authentication-error/">當我在 Windows 上使用任何 OpenStack CLI 時，發生鑑別失敗錯誤</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/Cannot_See_New_vCPUs/">為何 Horizon 中沒有列出我的新 vCPU？</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/floating-ips-error/">為何所有指派給我的浮動 IP 都無法使用？</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/no-valid-host-error/">錯誤：找不到有效的主機</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/horizon-delete-error/">為何無法從 Horizon 儀表板中刪除我的專案/租戶？</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/delete_security_group/">為何無法刪除安全群組？</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/Troubleshooting_FAQ/">疑難排解常見問題</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/Unable_to_ping_tenant_network/">為何無法在我的租戶網路之間執行 ping？</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/troubleshooting/Why_No_vIP_Failover_With_L2pop/">當我想要我的 vIP 執行實例進行失效接手時，為何無法使用 L2pop？</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 11 )</a></li>
      </ul>
    </li>
    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/openstack">Open Stack (15)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">User Docs</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/import-vhd-image-lvm/">匯入 VHD 映像檔，以對其根目錄使用 Linux 磁區管理</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/launch-instance-from-volume/">如何從磁區啟動執行實例</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/Mitaka_CLI_notes/">OpenStack Mitaka CLI 注意事項</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/openstack-storage-concepts/">OpenStack 儲存空間概念</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/OpenStack_network_concepts/">OpenStack 網路概念</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/Creating-an-Instance-with-a-Specific-Fixed-IP/">使用特定的固定 IP 建立執行實例</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/Why-Choose-OpenStack/">為什麼選擇 OpenStack？</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/Ursula_and_OpenStack/">Ursula 與 OpenStack</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/quotas/">配額</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/Creating_Instances_With_Static_IP/">如何使用靜態 IP 建立執行實例</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/How_to_Isolate_Tenants/">如何隔離租戶（專案）</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/userdocs/external-reference-material/">外部參照資料</a>
          </li>
          
        
        <li><a href="" class="page-link view">View More ( 3 )</a></li>
      </ul>

      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">API</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/api/openstack-api-getting-started/">開始使用 OpenStack API</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/openstack/api/floating-ip-address/">使用 OpenStack API 建立浮動 IP 位址</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/openstack/api/OpenStack_Client_Versions/">OpenStack 用戶端版本的需求</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 1 )</a></li>
      </ul>
    </li>




    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/horizon">Horizon [GUI] (10)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/horizon/creating-additional-networks-with-horizon/">使用 Horizon 畫面在 OpenStack 中建立其他網路</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/horizon/using-horizon/">使用 Horizon</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/horizon/allocate-floating-ip/">配置公用（浮動）IP  並將其附加至執行實例</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/horizon/create-volume-from-horizon/">從 Horizon 儀表板建立磁區</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/horizon/Making_Snapshots_in_Horizon/">對 Snapshot 使用 Horizon</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/horizon/set-reverse-dns/">如何設定 IBM Bluemix Private Cloud 執行實例的反向 DNS (PTR) 記錄？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/horizon/launch-instance-from-horizon/">從 Horizon 儀表板啟動執行實例</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/horizon/launch-instance-from-horizon_newton/">從 Horizon 儀表板啟動執行實例（OpenStack Newton 版本）</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/horizon/horizon-for-administrators/">管理者適用的 Horizon</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/horizon/Horizon_troubleshooting_FAQ/">Horizon 疑難排解常見問題</a>
          </li>
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/nova">Nova [Compute] (13)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/nova/CLI-create-public-instance/">如何使用指令行建立執行實例並使它可公開使用</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/windows-user-and-password/">如何在 Windows 執行實例中以 OpenStack 設定起始使用者名稱和密碼？</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/nova/Nova_boot_speed/">當我啟動虛擬機器時幕後發生什麼情況，以及如何使它啟動更快速？</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/nova/Restrict_Floating_IP/">如何限制浮動 IP？</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/config_drive_for_instances/">如何建立執行實例，並使用配置磁碟機為它新增檔案？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/create-vm-with-volumes/">如何使用 Nova 指令行用戶端建立執行實例？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/migrate-instance/">將執行實例移轉至新的雲端</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/deploy-to-specific-hypervisor/">How to deploy an instance to a specific hypervisor node</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/nova_live_migration/">Instance Live Migration</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/nova/maximum-flavor-spec/">我可以為虛擬硬體範本設定的最大規格為何？</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/nova/define-flavor-vcpu/">如何定義虛擬硬體範本 vCPU 拓蹼？</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/nova/Metadata_service_FAQ/">OpenStack Neutron 和 Nova 中的 Meta 資料服務</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/nova/hypervisor-statistics/">如何取得 Hypervisor 統計資料？</a>
          </li>
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/neutron">Neutron [Networking] (22)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/network_ip_availability/">如何檢查我的網路 IP 可用性？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/Multi-tier_Router_Configuration/">IBM Bluemix Private Cloud 內的多層路由器配置</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/routing_internal_traffic_between_projects/">在專案之間遞送內部資料流量</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/configure-dns.for-instances/">為執行實例配置 DNS</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/Load_Balancing_Methods/">負載平衡方法</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/set-up-dns-records/">如何設定指向 OpenStack 執行實例的 DNS 記錄？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/time-ip-associated-with-instance/">如何得知浮動 IP 與執行實例產生關聯或取消關聯的時間？</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/neutron/isolatetwoprojectnetworksconnectedtoonesharedrouter/">如何隔離已連接到共用路由器的專案網路？</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/creating-virtual-networks/">在 IBM Bluemix Private Cloud 上建立虛擬網路</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/neutron/add-ip-to-instance/">新增特定的固定專用 IP 至執行實例</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/neutron/configure-multi-nics/">為您自己的雲端映像檔配置多個網路介面</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/configure-ha-ip/">如何配置高可用性 IP</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/BYOFIP_support/">在 IBM Bluemix Private Cloud 與客戶網站之間使用 BYOFIP 連線功能</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/when_create_port_fails/">When creating port failed, how could I do ?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/vpn-vlan-directlink/">VPN、VLAN 和直接鏈結</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/How_Can_I_See_My_IPs/">如何查看我的 IP？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/How_to_update_DNS/">如何更新 DNS？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/Intro_to_LBaaS/">負載平衡器即服務 (LBaaS) 的簡介</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/Security_groups_CLI/">使用 CLI 來設定安全群組</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/neutron/Network_Use_Cases_White_Paper/">IBM Blue Box 網路使用案例</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/neutron/Where_Are_These_IPs/">前兩個 IP 在何處？</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/glance">Glance [Images] (6)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/glance/disk-capacity-constraints/">磁碟容量限制</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/glance/FAQ_Working_with_Windows_Images/">使用 Windows 映像檔的常見問題</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/glance/compatible-glance-images/">是否有官方的 OpenStack 相容映像檔清單可供我下載用於 Glance？（CentOS、Ubuntu 等等）</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/glance/Image_Properties_on_Power/">Power 計算節點上的 Glance 映像檔的最佳設定</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/glance/imagesnapshot/">映像檔與 Snapshot 之間的差異</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/cinder">Cinder [Block Storage] (13)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/cinder/cinder-volume-stuck/">Cinder 磁區停滯</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/cinder/read-only-cinder-error/">是什麼造成唯讀 Cinder 磁區，我要如何修正它們？</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/alternative_method_for_volume_encryption/">區塊儲存空間磁區加密的替代方法（使用 Ubuntu 訪客 VM）</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/Bug_Creating_Encrypted_Volumes/">不支援使用 Cinder 建立加密磁區</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/create-volume-from-snapshot/">是否支援透過執行實例 Snapshot 建立磁區？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/resize_cinder_volume/">我要如何調整 Cinder 磁區的大小？</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/cinder/Managing_block_storage/">管理區塊儲存空間</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/cli-create-volume/">使用指令行建立磁區</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/supported_volume_types/">在雲端執行實例中支援哪些 Cinder 磁區類型？</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/Ephemeral_to_Cinder/">如何從暫時磁碟移至 Cinder 儲存空間</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/volume_clone/">Can I enable volume full clone more than copy-on-write clone?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/Force_snapshot_on_attached_volume/">如何對連接的磁區強制執行 Snapshot</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/cinder/cinder-failed-connection-error/">如果 Cinder 用戶端傳回「錯誤：無法建立連線」訊息且無法連接，我該怎麼做？</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/keystone">Keystone [Identity] (8)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/k2k-federation/">IBM Bluemix Private Cloud 上的 Keystone 對 Keystone (K2K) 聯合</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/Managing_Users_and_Projects/">管理使用者和專案</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/RBAC_Definitions/">角色型存取控制</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/saml-federation/">IBM Bluemix Private Cloud 上的 Keystone SAML 聯合</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/oidc-federation/">IBM Bluemix Private Cloud 上的 OpenID Connect 聯合</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/keystone/Getting_Started_with_K2K_Identity/">開始使用 Keystone 聯合識別</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/custom-domains-keystone/">Keystone 第 3 版內的自訂網域</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/keystone/tenants-security-groups-keystone/">專案與安全群組</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/heat">Heat [Orchestration] (7)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/heat/Getting_Started_With_Heat/">開始使用 Heat 範本</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/zh_TW/heat/Deploying_apps_with_UCD/">使用 IBM UrbanCode Deploy 和 IBM Bluemix Private Cloud 來部署應用程式</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/heat/autoscaling-with-heat/">使用 Heat 進行自動調整</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/heat/using_heat_for_load_balancer/">使用 Heat 以佈建具有負載平衡器的伺服器</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/heat/using-ucd-ucdp/">搭配使用 IBM Urban Code Deploy 與 IBM Bluemix Private Cloud</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/heat/using_heat_for_deployment/">使用 Heat 與自簽憑證</a>
              </li>
            
          
        
      </ul>
    </li>


    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/zh_TW/ceilometer">Ceilometer [Telemetry] (1)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/zh_TW/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/zh_TW/ceilometer/compatible-glance-images/">是否支援透過執行實例 Snapshot 建立磁區？</a>
              </li>
            
          
        
      </ul>
    </li>

  </ul>
</div>


<article>

  <div class="page-container">

    <div class="main-content">
      <header class="post-header">

        <h1 class="post-title">
        

        

        HAProxy 可以處理多少同時連線？

        
        </h1>




        
        <div class="post-data">
          <img src='/help-documentation/img/zh_TW/avatar.png' />
          <ul class="author--info">
            <li>
              <span class="author">by Lampros Chaidas </span>
              <span class="dot">&#9679;</span>
              <span class="date"> October 21, 2016</span>
            </li>
            <li>
              <span class="job-title"></span>
            </li>
            <li class="tags">
              
                <h4>Tags:</h4>
                  <ul class="tag--list">
                  
                    <li class="tag"><p>troubleshooting</p></li>
                  
                    <li class="tag"><p>疑難排解</p></li>
                  
                    <li class="tag"><p>haproxy</p></li>
                  
                    <li class="tag"><p>maxconn</p></li>
                  
                    <li class="tag"><p>負載測試</p></li>
                  
                  </ul>
              
            </li>
          </ul>
        </div>
        
      </header>

      <div class="post-content">
        <p><strong>請注意：</strong>本文並「非」專門針對 OpenStack Neutron LBaaS，而只談在執行實例內執行的 HAProxy。</p>

<p>最近，我一直在查看客戶的負載平衡配置。檢查客戶的 HAProxy 狀態頁面時，想到一個問題：「它們到底可以支援多少同時連線？」</p>

<p>每個後端伺服器的連線數上限很重要嗎？本文提供一種方法，讓您可以判定 <a href="http://www.haproxy.org/">HAProxy</a> 所能處理的同時連線數。</p>

<p>我們將在 <strong>CentOS 6 VPS</strong> 上安裝 HAProxy，並執行一系列測試來尋找答案。在不同的 VPS 上，我們將設定評比公用程式。</p>

<h2 id="需求">需求：</h2>

<ul>
  <li>2x CentOS 6.x VPS</li>
</ul>

<p>我在這些測試中使用的 VPS 規格為：</p>

<ul>
  <li>2GB RAM</li>
  <li>2 核心</li>
  <li>CentOS 6.7</li>
</ul>

<h2 id="在-haproxy-vps-上安裝-haproxy">在 HAProxy VPS 上安裝 HAProxy：</h2>

<p>步驟 1. 安裝適用於 <strong>CentOS 6</strong> 的 HAProxy <a href="https://ius.io/">IUS (Inline with Upstream Stable) repo</a>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  yum -y install https://centos6.iuscommunity.org/ius-release.rpm
</code></pre>
</div>

<p>步驟 2. 取得最新版本的 HAProxy - 撰寫這篇文章時的版本是 <code class="highlighter-rouge">1.6.9</code>。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  yum -y install haproxy16u &amp;&amp; chkconfig haproxy on
</code></pre>
</div>

<p>步驟 3. 將預設的 HAproxy 配置移到其他地方，以防您稍後還需檢查該配置：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg-default
</code></pre>
</div>

<p>步驟 4. 配置 <a href="http://www.rsyslog.com/">rsyslog</a> 接收來自 HAProxy 的日誌：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  sed -i -- 's/#$ModLoad imudp/$ModLoad imudp/g' /etc/rsyslog.conf
  sed -i -- 's/#$UDPServerRun 514/$UDPServerRun 514/g' /etc/rsyslog.conf
  echo "\$UDPServerAddress 127.0.0.1" &gt;&gt; /etc/rsyslog.conf
  echo "local2.* -/var/log/haproxy.log" &gt;&gt; /etc/rsyslog.conf
</code></pre>
</div>

<p>先前的指令會將 <code class="highlighter-rouge">rsyslog</code> 設為接聽 UDP 埠 <code class="highlighter-rouge">514</code>，並將它限制為只接受 <code class="highlighter-rouge">localhost</code> 連線。最後一行會將 HAProxy 日誌設為寫入 <code class="highlighter-rouge">/var/log/haproxy.log</code>。</p>

<p>步驟 5. 重新啟動 <code class="highlighter-rouge">rsyslog</code>，讓變更生效：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  service rsyslog restart
</code></pre>
</div>

<p>步驟 6. 新增 HAProxy 配置 (<code class="highlighter-rouge">/etc/haproxy/haproxy.cfg</code>)，記下 <code class="highlighter-rouge">maxconn 20</code> 行。請依照<a href="https://cbonte.github.io/haproxy-dconv/1.6/configuration.html#maxconn">說明頁</a>「Proxy 會在達到此限制時，停止接受連線。」換句話說，此配置最多只能同時容許 <strong>20</strong> 個連線。</p>

<p><code class="highlighter-rouge">fullconn 20</code> 行是什麼？在<a href="https://cbonte.github.io/haproxy-dconv/1.6/configuration.html#4-fullconn">說明頁</a>中，它定義為「後端可以讓伺服器使用連線數上限的連線數」。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>global
daemon
# we need the socket for hatop statistics
stats socket /var/run/haproxy.sock mode 600 level admin
log /dev/log local4
maxconn 20

defaults
log global
timeout connect 4000
timeout client 42000
timeout server 43000

listen lampros-pool-1
bind *:80
mode http
balance roundrobin
fullconn 20
server go_http_server_1 127.0.0.1:8080 cookie go_http_server_1 check inter 2000 rise 2 fall 3

</code></pre>
</div>

<h2 id="安裝-go-語言---請在兩台伺服器上執行此作業">安裝 Go 語言 - 請在兩台伺服器上執行此作業：</h2>

<p>安裝 Go 語言，以及 <code class="highlighter-rouge">screen</code> 公用程式和 <code class="highlighter-rouge">git</code>。我們需要兩台伺服器上都有這個語言，因為在 HAProxy VPS 上，我們將編譯非常基本的應用程式伺服器。在基準性能測試程式 VPS 中，我們需要 Go，這樣才能執行 <a href="https://github.com/cmpxchg16/gobench">gobench</a> 基準性能測試程式公用程式。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yum -y install git screen nc
cd /tmp
wget https://storage.googleapis.com/golang/go1.7.linux-amd64.tar.gz
tar -xvf go1.7.linux-amd64.tar.gz
mv go /usr/local
export GOROOT=/usr/local/go
mkdir /root/goapps
export GOPATH=/root/goapps
export PATH=$PATH:$GOPATH/bin:$GOROOT/bin
echo export "GOPATH=/root/goapps" &gt;&gt; ~/.bashrc
echo export "export PATH=$PATH:$GOPATH/bin:$GOROOT/bin" &gt;&gt; ~/.bashrc
</code></pre>
</div>

<h2 id="在-haproxy-伺服器上我們將使用-go-設定基本應用程式伺服器">在 HAProxy 伺服器上，我們將使用 Go 設定基本應用程式伺服器：</h2>

<p>步驟 1. 建立稱為 <code class="highlighter-rouge">/root/slowserver</code> 的目錄</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  mkdir -pv /root/slowserver
</code></pre>
</div>

<p>步驟 2. 在該目錄中，新增含有下列內容的 <code class="highlighter-rouge">/root/slowserver/slowserver.go</code> 檔案：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>package main

import (
    "fmt"
    "net/http"
    "time"
)

func slow_handler(w http.ResponseWriter, r *http.Request) {
    time.Sleep(3000 * time.Millisecond)
    fmt.Fprintf(w, "I'm slooooow")
}

func fast_handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "I'm FAST!!!!")
}

func main() {
    http.HandleFunc("/fast", fast_handler)
    http.HandleFunc("/slow", slow_handler)
    http.ListenAndServe(":8080", nil)
}
</code></pre>
</div>

<p>步驟 3. 使用 <code class="highlighter-rouge">go build</code> 編譯此檔案：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  cd /root/slowserver
  go build
</code></pre>
</div>

<p>步驟 4. 在分離畫面階段作業中啟動 slowserver，讓它停留在背景中：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  screen -d -m -t go_slowserver /root/slowserver/slowserver
</code></pre>
</div>

<p>步驟 5. 確認它是使用 <code class="highlighter-rouge">netstat -ntlp | grep slowserver</code> 執行 - 您應該會看到它用來接聽的埠以及程序 ID。下面是我取得的輸出：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  netstat -ntlp | grep slowserver
  tcp        0      0 :::8080                     :::*                        LISTEN      5204/slowserver
</code></pre>
</div>

<h2 id="在-haproxy-伺服器上設定-hatop">在 HAProxy 伺服器上設定 HATop</h2>

<p>步驟 1. 下載及安裝 <a href="http://feurix.org/projects/hatop/">HATop</a>，讓我們可以監視 HAProxy：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  cd /tmp
  wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/hatop/hatop-0.7.7.tar.gz
  tar -xzf hatop-0.7.7.tar.gz
  cd hatop-0.7.7
  install -m 755 bin/hatop /usr/local/bin
  install -m 644 man/hatop.1 /usr/local/share/man/man1
  gzip /usr/local/share/man/man1/hatop.1
</code></pre>
</div>

<p>步驟 2. 啟動 HAProxy：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  service haproxy start
</code></pre>
</div>

<p>步驟 3. 啟動 HAtop：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  hatop -s /var/run/haproxy.sock
</code></pre>
</div>

<p>步驟 4. 現在，我們使用單行指令來詢問 HAProxy 有關後端伺服器 <strong>go_http_server_1</strong> 的狀態：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  echo "show stat" | nc -U /var/run/haproxy.sock | awk -F, '/go_http_server/{print $18}'
</code></pre>
</div>

<p>您應該會取得下列輸出：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  UP
</code></pre>
</div>

<h2 id="在我們將用來執行測試的-vps-上執行下列動作">在我們將用來執行測試的 VPS 上，執行下列動作：</h2>

<p>下載 <a href="https://github.com/cmpxchg16/gobench">gobench</a> 基準性能測試程式公用程式：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  go get github.com/cmpxchg16/gobench
</code></pre>
</div>

<h2 id="負載測試---每個後端伺服器的連線數上限很重要嗎無人為延遲">負載測試 - 每個後端伺服器的連線數上限很重要嗎？（無人為延遲）</h2>

<p>在第一個測試中，我們將嘗試判定 <code class="highlighter-rouge">fullconn</code> 設定是否會對結果造成任何影響。第一次執行時，我們將 <code class="highlighter-rouge">fullconn</code> 設為 <code class="highlighter-rouge">20</code>，第二次執行時，則將它設為 <code class="highlighter-rouge">1</code>。我們將使用 <code class="highlighter-rouge">20</code> 個快速用戶端（無人為延遲），校準 <code class="highlighter-rouge">30</code> 秒的評比測試：</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> fast</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/fast -c 20 -t 30
</code></pre>
</div>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 20 clients
Waiting for results...

Requests:                           627867 hits
Successful requests:                627867 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:            20928 hits/sec
Read throughput:                   2699828 bytes/sec
Write throughput:                  1841801 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>現在，在我們重新執行測試之前，要先修改 HAProxy 的配置並將 <code class="highlighter-rouge">fullconn</code> 設為 <code class="highlighter-rouge">1</code>。我們使用 <code class="highlighter-rouge">sed</code> 來執行此測試，然後重新載入 HAProxy：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sed -i -- 's/fullconn 20/fullconn 1/g' /etc/haproxy/haproxy.cfg
/etc/init.d/haproxy reload
</code></pre>
</div>

<p>摘要如下：</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 1</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> fast</li>
</ul>

<p>現在，重新執行相同的測試：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/fast -c 20 -t 30
</code></pre>
</div>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/fast -c 20 -t 30
Dispatching 20 clients
Waiting for results...

Requests:                           527141 hits
Successful requests:                527141 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:            17571 hits/sec
Read throughput:                   2266727 bytes/sec
Write throughput:                  1546353 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>如您所見：在第一個測試中，我們得到 20928 點擊數/秒，而在第二個測試中，我們得到 17571 點擊數/秒。如果應用程式伺服器的速度很慢，而且每次要花 3 秒來回覆，該怎麼辦呢？</p>

<h2 id="負載測試---每個後端伺服器的連線數上限很重要嗎3-秒人為延遲">負載測試 - 每個後端伺服器的連線數上限很重要嗎？（3 秒人為延遲）</h2>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p>開始之前，將 <code class="highlighter-rouge">fullconn</code> 變更回 <code class="highlighter-rouge">20</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sed -i -- 's/fullconn 1/fullconn 20/g' /etc/haproxy/haproxy.cfg
/etc/init.d/haproxy restart
</code></pre>
</div>

<p>重新測試：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
</code></pre>
</div>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
Dispatching 20 clients
Waiting for results...

Requests:                              180 hits
Successful requests:                   180 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                      586 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>將 <code class="highlighter-rouge">fullconn</code> 變更回 <code class="highlighter-rouge">1</code>，然後重新測試：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sed -i -- 's/fullconn 20/fullconn 1/g' /etc/haproxy/haproxy.cfg
/etc/init.d/haproxy restart
</code></pre>
</div>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 1</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
</code></pre>
</div>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 20 clients
Waiting for results...

Requests:                              180 hits
Successful requests:                   180 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                      586 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<h2 id="結論負載測試---每個後端伺服器的連線數上限很重要嗎">結論：負載測試 - 每個後端伺服器的連線數上限很重要嗎？</h2>

<p>答案是肯定。它很重要，但只有在伺服器速度很快時。伺服器速度緩慢時，看起來結果並沒有任何差異。</p>

<h2 id="負載測試---判定-haproxy-可以處理的同時連線數">負載測試 - 判定 HAProxy 可以處理的同時連線數</h2>

<p>現在，我們要看看 HAProxy 所能處理的同時連線數。開始之前，不能忘記有關 HAProxy 的一項基本詳細資料：<a href="https://cbonte.github.io/haproxy-dconv/1.6/configuration.html#1.1">「依預設，HAProxy 會以持續連線的保持作用中模式運作：在每個連線中，它會處理每個要求和回應，然後在回應結束和新要求開始之間，將這兩端的連線維持在閒置狀態。」</a></p>

<p>此說明表示長時間執行的連線對伺服器所造成的影響比短期連線大。因此，我們將對應用程式伺服器的「慢速」功能執行測試。</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
</code></pre>
</div>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 20 clients
Waiting for results...

Requests:                              180 hits
Successful requests:                   180 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                      586 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>我們看到 <code class="highlighter-rouge">6 hits/sec</code>，且未報告任何錯誤。我們再用五倍的用戶端數量 (100) 試試。</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
</code></pre>
</div>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 100 clients
Waiting for results...

Requests:                              266 hits
Successful requests:                   180 hits
Network failed:                         86 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                     1120 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>還是得到 <code class="highlighter-rouge">6 hits/sec</code>，但這次有錯誤。錯誤表示 HAProxy 配置已達其上限，因為每秒點擊數已無法再增加，所以同時我們將收到這些錯誤。讓我們嘗試用相同的用戶端數量 (100)，但將 <code class="highlighter-rouge">maxconns</code> 值加倍，看看會發生什麼：</p>

<ul>
  <li><strong>maxconn</strong> 40</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              426 hits
Successful requests:                   360 hits
Network failed:                         66 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               12 hits/sec
Read throughput:                      1548 bytes/sec
Write throughput:                     1630 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>如同先前測試所預期，<code class="highlighter-rouge">fullconn</code> 不會真的造成限制。將 <code class="highlighter-rouge">maxconns</code> 值加倍後，點擊率確實變成兩倍 (<code class="highlighter-rouge">12 hits/sec</code>)，雖然還是會收到錯誤，但這表示 HAProxy 配置還是超過其限制。</p>

<p>我們再次提高 <code class="highlighter-rouge">maxconns</code> 值 - 這次設為 <code class="highlighter-rouge">60</code>：</p>

<ul>
  <li><strong>maxconn</strong> 60</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              595 hits
Successful requests:                   540 hits
Network failed:                         55 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               18 hits/sec
Read throughput:                      2322 bytes/sec
Write throughput:                     2179 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>如您所見，每次提高 <code class="highlighter-rouge">maxconn</code> 限制，<code class="highlighter-rouge">hits/sec</code> 就會呈線性增加。我們繼續這麼做，直到沒有錯誤為止：</p>

<ul>
  <li><strong>maxconn</strong> 80</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              760 hits
Successful requests:                   720 hits
Network failed:                         40 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               24 hits/sec
Read throughput:                      3096 bytes/sec
Write throughput:                     2698 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<ul>
  <li><strong>maxconn</strong> 100</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p><strong>結果：</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              900 hits
Successful requests:                   900 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               30 hits/sec
Read throughput:                      3870 bytes/sec
Write throughput:                     2933 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<h2 id="結論負載測試---判定-haproxy-可以處理的同時連線數">結論：負載測試 - 判定 HAProxy 可以處理的同時連線數</h2>

<p>我們可以從之前的實驗得到的結論如下：為了測試容量（連接 HAProxy 的用戶端數量上限），我們必須使用開啟了 TCP 連線，但將連線保持開啟一段延長時間（3 秒）的伺服器。這與測試伺服器速度多快相反，即您推入的資料流量愈多，得到的結果愈好。</p>

<p>第二個結論是您的連線數上限 (<code class="highlighter-rouge">maxconn</code>) 必須大於要求速率（例如 100 個用戶端）* 時間（3 秒），才能服務每一個要求。</p>

<p>例如：</p>

<p><code class="highlighter-rouge">maxconn</code>=100*3 =&gt; <code class="highlighter-rouge">maxconn</code>=300</p>

<h2 id="來源">來源：</h2>

<ul>
  <li><a href="https://www.percona.com/blog/2014/10/03/haproxy-give-me-some-logs-on-centos-6-5/">Percona - HAProxy：提供我一些 CentOS 6.5 的日誌！</a></li>
  <li><a href="http://www.loadbalancer.org/uk/blog/setting-up-haproxy-with-transparent-mode-on-centos-6-x">在 Centos 6.x 上使用透通模式設定 HAProxy</a></li>
  <li><a href="https://golang.org/doc/articles/wiki/">Go 程式設計語言 - 撰寫 Web 應用程式</a></li>
  <li><a href="http://unix.stackexchange.com/a/267794">堆疊交換 - 在一個畫面中執行 Script</a></li>
  <li><a href="http://tecadmin.net/install-go-on-centos/">TecAdmin.net - 如何在 CentOS/RHEL 7/6/5 上安裝 Go 1.7</a></li>
  <li><a href="http://feurix.org/projects/hatop/">Feurix 免費開放程式碼專案 - HATop</a></li>
  <li><a href="http://www.serverlab.ca/tutorials/linux/network-services/monitoring-haproxy-using-hatop/">Serverlab - 使用 HATOP 監視 HAProxy</a></li>
  <li><a href="https://github.com/cmpxchg16/gobench">Github.com - GoBench - HTTP/HTTPS 負載測試與評比工具</a></li>
</ul>

      </div>
    </div>

  </div>
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="footer__wrapper--light">

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Products</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="nav--item__link">Bluemix Private Cloud</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-local" class="nav--item__link">Private Cloud Local</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-contact-us" class="nav--item__link">Sales</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-faq" class="nav--item__link">FAQs</a>
      </li>
    
    </ul>

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Our Story</a>
      </li>
 <li class="footer--nav__item">
        <a href="https://github.com/blueboxgroup?cm_mc_uid=04946053248414876234663&cm_mc_sid_50200000=1489010497" class="nav--item__link">On GitHub</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://blueboxstatus.com/" class="nav--item__link">System Status</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://support.bluebox.net/" class="nav--item__link">Support</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://support.bluebox.net/" class="nav--item__link">Box Panel</a>
      </li>
    </ul>

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Resources
        </a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Case Studies</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="nav--item__link">Videos</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="nav--item__link">News</a>
      </li>
    </ul>

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="hhttps://www.ibm.com/blogs/bluemix/">Recent Blog Posts</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/07/the-power-of-openstack/" class="nav--item__link">The Power of OpenStack</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/08/blue-box-storage-models-explained/" class="nav--item__link">IBM Bluemix Private Cloud Storage Models</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.blueboxcloud.com/insight/blog-article/github-ibm-com-running-on-blue-box" class="nav--item__link">IBM Github Runs on Bluemix Private Cloud</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/10/building-up-to-openstack/" class="nav--item__link">Building up to OpenStack</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/07/keystone-to-keystone-federated-identity-on-blue-box-cloud/" class="nav--item__link">Get Started with Keystone Federation</a>
      </li>
    </ul>
  </div>
  <div class="footer__wrapper--dark">
    <ul class="footer--list">
      <li class="list--item">
        <a href="https://www.facebook.com/BlueBoxGroup/" class="list--item__link">Facebook</a>
      </li>
      <li class="list--item">
        <a href="https://twitter.com/bluebox?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" class="list--item__link">Twitter</a>
      </li>
      <li class="list--item">
        <a href="https://www.linkedin.com/company/blue-box-group" class="list--item__link">LinkedIn</a>
      </li>
      <li class="list--item">
        <a href="https://plus.google.com/+BlueBoxSeattle/posts" class="list--item__link">Google +</a>
      </li>
      <li class="list--item">
        <a href="https://github.com/blueboxgroup" class="list--item__link">GitHub</a>
      </li>
    </ul>

    <ul class="footer--list">
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-contact-us" class="list--item__link">Contact</a>
      </li>
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="list--item__link">Legal</a>
      </li>
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="list--item__link">Privacy Policy</a>
      </li>
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="list--item__link">Terms and Conditions</a>
      </li>

    </ul>
  </div>
  <div class="footer__wrapper--black">
    <p>
        &copy; 2017 IBM Bluemix
    </p>
  </div>
</footer>



    <script src="/help-documentation/js/vendor/simple-jekyll-search.js" type="text/javascript"></script>


    <script>
        SimpleJekyllSearch({
          searchInput: document.getElementById('search-input'),
          resultsContainer: document.getElementById('results-container'),
          json: '/help-documentation/search.json',
          searchResultTemplate: '<li class="search-item"><a href="{url}" class="item-title">{title}</a><ul class="tag--list">{tags}</ul></li>'
        });
    </script>
  <script src="/help-documentation/js/scripts.js"></script>

  </body>

</html>
