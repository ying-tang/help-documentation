<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HAProxy で処理できる最大同時接続数</title>
  <meta name="description" content="ご留意事項: この記事は、特に OpenStack Neutron LBaaS に関連しているわけではなく、インスタンス内で実行されている HAProxy にのみ関連しています。最近、お客様のロード・バランシング構成を確認していました。お客様と HAProxy 状態ページを調べているときに、「実際にサポートできる...">

  <link rel="stylesheet" href="/help-documentation/css/main.css">
  <link rel="canonical" href="/help-documentation/ja/troubleshooting/How_many_connections_can_HAProxy_handle/">
  <link rel="alternate" type="application/rss+xml" title="Blue Box Help" href="/help-documentation/ja/feed.xml">
  
  <style>
   .site-header img:first-child {
       height: 72px;
}
</style>
  
</head>


  <body>

  
    <header class="site-header">

  <div class="header-wrapper">

    <a class="site-title" href="/help-documentation/ja/"><img src="/help-documentation/img/ja/Bluemix-logo-UI.svg" alt="" height="72px"></a>

    <div class="search--pageview">

  <div class="full-view__search hide">
    <a href="" class="x hide">X</a>
    <ul id="results-container"></ul>
    <ul class="results--container"></ul>

  </div>
  <div class="input-container">
    <label for="search__fullview" class="hide search--label">Search IBM Bluemix Private Cloud Help</label>
    <input type="text" id="search-input" placeholder="" name="search" class="search__minview--page">
    <img src="/help-documentation/img/ja/search.svg" class="search-icon" />
  </div>
</div>


    <a href="mailto:llundquist@us.ibm.com" class="header--request">
      <p>
        Submit A Request
      </p>
      <img src="/help-documentation/img/ja/user.svg">
    </a>
    <a id="nav-toggle" href="#"><span></span></a>

    <div>
  
    
      <a  href=" /help-documentation/troubleshooting/How_many_connections_can_HAProxy_handle/ ">en</a> |
    
      <a  href=" /help-documentation/fr/troubleshooting/How_many_connections_can_HAProxy_handle/ ">fr</a> |
    
      <a  href=" /help-documentation/de/troubleshooting/How_many_connections_can_HAProxy_handle/ ">de</a> |
    
      <a style="font-weight: bold;" href=" /help-documentation/ja/troubleshooting/How_many_connections_can_HAProxy_handle/ ">ja</a> |
    
      <a  href=" /help-documentation/zh_CN/troubleshooting/How_many_connections_can_HAProxy_handle/ ">zh_CN</a> |
    
      <a  href=" /help-documentation/zh_TW/troubleshooting/How_many_connections_can_HAProxy_handle/ ">zh_TW</a> |
    
      <a  href=" /help-documentation/pt_BR/troubleshooting/How_many_connections_can_HAProxy_handle/ ">pt_BR</a> |
    
  
</div>

  </div>

</header>

  

  
  <div class="page-content">
  

      <div class="main-wrapper">
        
<div class="sidebar sidebar--toggled">
  <ul class="sidebar__nav">
    <li>
      <h3 class="title">
        
        
        
        <a  class="page-link"  href="/help-documentation/ja/gettingstarted">Getting Started (38)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">Common Technical Questions</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/connect-to-openvpn-server/">OpenVPN サーバーへの接続</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/openvpn-setup/">インスタンスでの OpenVPN サーバーのセットアップ</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/blue-box-cloud-components/">Bluemix Private Cloud コンポーネント</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/detaching-volume/">ボリュームを切り離す前に何をすればよいですか?</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/python-environment-primer/">python 仮想環境への取り組み: 開発者の手引き</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/FAQ/">技術 FAQ</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/Building_Blocks/">IBM Bluemix Private Cloud ビルディング・ブロック (Community Edition)</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/RHOSP_Building_Blocks/">IBM Bluemix Private Cloud with Red Hat 用のビルディング・ブロック</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/RHOSP_Product_Overview/">IBM Bluemix Private Cloud with Red Hat - 製品概要</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/general_product_overview/">一般的な製品概要</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/Instance_Resize/">インスタンスのサイズ変更 (非ライブ)</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/Connecting_Clouds_with_SoftLayer/">プライベート・ネットワークの使用による複数のクラウド環境間でのネットワーク接続のセットアップ</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commontech/Windows_License_Activation/">Windows アクティベーションのためのお客様ガイド</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 7 )</a></li>
      </ul>
      
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">Common Administrative Questions</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commonadmin/adding-removing-subscribers/">チケットへのサブスクライバーの追加または削除</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commonadmin/view-my-bill/">請求書を確認するにはどうすればよいですか?</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commonadmin/report-issue/">問題を報告するにはどうすればよいですか?</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/gettingstarted/commonadmin/escalating-a-ticket/">チケットをエスカレートするにはどうすればよいですか?</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commonadmin/status-pages/">Bluemix Private Cloud の状況ページ</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/gettingstarted/commonadmin/Transferring_A_Domain_From_Blue_Box/">Blue Box からのドメインの転送</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 2 )</a></li>
      </ul>
      
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">User Guides</h5>
        
        
          
             
         
             
         
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Box_Panel/">Box Panel ユーザー・ガイド</a>
                  </li>
              
             
         
             
                <li>
                <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Eternal_Blue-ish_Triangle/">Box Panel、サイト・コントローラー、および IBM Bluemix Private Cloud Local</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/qemu_article/">OpenStack の構築 — QEMU とクラウド</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Improving_Cloud_Performance/">OpenStack の構築 II -- クラウド・パフォーマンスの向上</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Optimized_Load_Balancing/">クラウド基礎 -- 最適化されたロード・バランシング</a>
                </li>
              
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Cloud_Images_Provided_RHOSP/">クラウド・イメージのユーザーズ・ガイド (IBM Bluemix Private Cloud with Red Hat)</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Cloud_Images_Provided_by_IBM/">クラウド・イメージのユーザーズ・ガイド (コミュニティー版)</a>
                  </li>
              
             
         
             
         
             
         
             
         
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/gettingstarted/userguides/Image_Release_Notes/">IBM Bluemix Private Cloud イメージのリリース・ノート</a>
                  </li>
              
             
         
        <li><a href="" class="page-link view">View More ( 4 )</a></li>
      </ul>
      
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">Release Notes</h5>
        
        
          
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_3.0.1_Point_Release/">お客様向け 3.0.1 ポイントのリリース・ノート</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_3.1.1_Point_Release/">カスタマー 3.1.1 ポイントのリリース・ノート</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_4.0.0.0c_Release_Notes/">Release Notes 4.0.0.0c</a>
                  </li>
              
             
         
             
                <li>
                <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_4.0.0.0r_Release_Notes/">リリース・ノート 4.0.0.0r</a>
                </li>
              
         
             
                <li>
                <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_2.1.1_Point_Release/">リリース・ノート 2.1.1</a>
                </li>
              
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/releasenotes/release_notes_2.1_for_customers/">リリース・ノート 2.1</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_3.0.0_Release_Notes/">リリース・ノート 3.0.0</a>
                  </li>
              
             
         
             
                
                  
                  <li class="hidden non-featured">
                    <a class="page-link" href="/help-documentation/ja/releasenotes/Customer_3.1.0_Release_Notes/">リリース・ノート 3.1.0</a>
                  </li>
              
             
         
        <li><a href="" class="page-link view">View More ( 6 )</a></li>
      </ul>
    </li>
    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/troubleshooting">Troubleshooting (19)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/troubleshooting/libvirt_error/">エラー状況 (libvirt エラー) のインスタンス</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/troubleshooting/ssh-too-long-error/">インスタンスに SSH で接続するのに 4 から 5 秒もかかるのはどうしてですか?</a>
          </li>
          
        
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/troubleshooting/ping-instance-error/">インスタンスに SSH/ping できないのはどうしてですか?</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/troubleshooting/nova-microversions-error/">Nova コマンドを実行した場合のエラー「Server doesn't support microversions」</a>
          </li>
          
        
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/Bad_Availability_Zone/">Cloud Foundry: 無効な可用性ゾーン・エラー</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/failed_to_create_router/">ルーターの作成試行が失敗する</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link--active"  href="/help-documentation/ja/troubleshooting/How_many_connections_can_HAProxy_handle/">HAProxy で処理できる最大同時接続数</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/CLI-authentication-error/">Windows で OpenStack CLI のいずれかを使用すると、認証障害エラーが発生します</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/floating-ips-error/">割り当てられている一部の浮動 IP が使用可能でないのはどうしてですか?</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/horizon-delete-error/">Horizon ダッシュボードからプロジェクト/テナントを削除できないのはどうしてですか?</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/no-valid-host-error/">エラー「No valid host was found」</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/Cannot_See_New_vCPUs/">Horizon で新規 vCPU がリストされないのはどうしてですか?</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/failure_prepping_block_device/">エラー「Failure prepping block device」</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/delete_security_group/">セキュリティー・グループを削除できないのはどうしてですか?</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/troubleshooting/Troubleshooting_FAQ/">トラブルシューティングの FAQ</a>
          </li>
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/Unable_to_ping_tenant_network/">テナント・ネットワーク間で ping できないのはどうしてですか?</a>
              </li>
            
          
        
          
            
            
              <li class="hidden non-featured">
                  <a class="page-link" href="/help-documentation/ja/troubleshooting/Why_No_vIP_Failover_With_L2pop/">vIP インスタンスがフェイルオーバーするようにする場合に L2pop を使用できないのはどうしてですか?</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 11 )</a></li>
      </ul>
    </li>
    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/openstack">Open Stack (15)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">User Docs</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/launch-instance-from-volume/">ボリュームからのインスタンスの起動方法</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/import-vhd-image-lvm/">ルート・ディレクトリーに Linux ボリューム管理を使用している VHD イメージのインポート</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/openstack/userdocs/OpenStack_network_concepts/">OpenStack のネットワークの概念</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/Creating-an-Instance-with-a-Specific-Fixed-IP/">特定の固定 IP を使用したインスタンスの作成</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/Mitaka_CLI_notes/">OpenStack Mitaka CLI に関する注記</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/openstack/userdocs/Why-Choose-OpenStack/">OpenStack を選ぶ理由</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/openstack/userdocs/openstack-storage-concepts/">OpenStack ストレージの概念</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/Ursula_and_OpenStack/">Ursula と OpenStack</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/Creating_Instances_With_Static_IP/">静的 IP を使用したインスタンスの作成方法</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/quotas/">割り当て量</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/How_to_Isolate_Tenants/">テナント (プロジェクト) を分離する方法</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/userdocs/external-reference-material/">外部参照資料</a>
          </li>
          
        
        <li><a href="" class="page-link view">View More ( 3 )</a></li>
      </ul>

      <ul  class="article__list slide-up-hidden" >
        <h5 class="sub__head">API</h5>
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/api/floating-ip-address/">OpenStack API を使用した浮動 IP アドレスの作成</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/openstack/api/openstack-api-getting-started/">OpenStack API 概要</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/openstack/api/OpenStack_Client_Versions/">OpenStack クライアント・バージョンの要件</a>
              </li>
            
          
        
        <li><a href="" class="page-link view">View More ( 1 )</a></li>
      </ul>
    </li>




    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/horizon">Horizon [GUI] (10)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/horizon/creating-additional-networks-with-horizon/">Horizon パネルを使用した OpenStack での追加ネットワークの作成</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/horizon/Making_Snapshots_in_Horizon/">スナップショットのための Horizon の使用</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/horizon/allocate-floating-ip/">インスタンスへのパブリック (浮動) IP の割り振りおよび関連付け</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/horizon/create-volume-from-horizon/">Horizon ダッシュボードからのボリュームの作成</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/horizon/horizon-for-administrators/">管理者のための Horizon</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/horizon/launch-instance-from-horizon/">Horizon ダッシュボードからのインスタンスの起動</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/horizon/launch-instance-from-horizon_newton/">Horizon ダッシュボードからのインスタンスの起動 (OpenStack Newton リリース)</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/horizon/set-reverse-dns/">IBM Bluemix Private Cloud インスタンスに対してリバース DNS (PTR) レコードはどのように設定しますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/horizon/using-horizon/">Horizon の使用</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/horizon/Horizon_troubleshooting_FAQ/">Horizon トラブルシューティングの FAQ</a>
          </li>
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/nova">Nova [Compute] (13)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/windows-user-and-password/">OpenStack で Windows インスタンス上の初期ユーザー名およびパスワードを設定する方法</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/nova_live_migration/">Instance Live Migration</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/nova/CLI-create-public-instance/">コマンド・ラインを使用してインスタンスを作成して公開する方法</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/nova/Nova_boot_speed/">仮想マシンのブート時に水面下で何が行われていますか? また、どうすればブート時間を短縮できますか?</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/nova/Restrict_Floating_IP/">浮動 IP を制限するにはどうすればよいでしょうか?</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/config_drive_for_instances/">インスタンスを作成し、config drive を使用してファイルをそのインスタンスに追加できますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/create-vm-with-volumes/">Nova コマンド・ライン・クライアントを使用したインスタンスの作成方法</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/nova/define-flavor-vcpu/">フレーバー vCPU トポロジーを定義する方法</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/deploy-to-specific-hypervisor/">How to deploy an instance to a specific hypervisor node</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/maximum-flavor-spec/">フレーバーで設定できる最大の仕様はどのようになりますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/nova/migrate-instance/">新しいクラウドへのインスタンスのマイグレーション</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/nova/Metadata_service_FAQ/">OpenStack Neutron および Nova でのメタデータ・サービス</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/nova/hypervisor-statistics/">ハイパーバイザー統計を取得する方法</a>
          </li>
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/neutron">Neutron [Networking] (22)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/network_ip_availability/">ネットワークの IP の可用性を確認する方法</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/neutron/isolatetwoprojectnetworksconnectedtoonesharedrouter/">共有ルーターに接続されたプロジェクト・ネットワークを分離する方法</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/time-ip-associated-with-instance/">インスタンスに対する浮動 IP の関連付けまたは関連付け解除が行われた時刻を確認するにはどのようにすればよいでしょうか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/Load_Balancing_Methods/">ロード・バランシング方法</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/Multi-tier_Router_Configuration/">IBM Bluemix Private Cloud 内の多層ルーター構成</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/set-up-dns-records/">OpenStack インスタンスを指す DNS レコードをセットアップするにはどうすればよいでしょうか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/routing_internal_traffic_between_projects/">プロジェクト間での内部トラフィックのルーティング</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/neutron/add-ip-to-instance/">インスタンスへの特定の固定プライベート IP の追加</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/configure-dns.for-instances/">インスタンスに対する DNS の構成</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/neutron/configure-multi-nics/">独自のクラウド・イメージに対する複数のネットワーク・インターフェースの構成</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/configure-ha-ip/">高可用性 IP の構成方法</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/creating-virtual-networks/">IBM Bluemix Private Cloud での仮想ネットワークの作成</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/when_create_port_fails/">When creating port failed, how could I do ?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/How_Can_I_See_My_IPs/">自分の IP はどのように確認できますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/How_to_update_DNS/">DNS はどのように更新できますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/vpn-vlan-directlink/">VPN、VLAN、および Direct Link</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/BYOFIP_support/">IBM Bluemix Private Cloud とお客様サイトの間での BYOFIP 接続の使用</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/Intro_to_LBaaS/">Load Balancer as a Service (LBaaS) の概要</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/Security_groups_CLI/">CLI を使用したセキュリティー・グループのセットアップ</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/neutron/Network_Use_Cases_White_Paper/">IBM Blue Box のネットワークのユース・ケース</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/neutron/Where_Are_These_IPs/">最初の 2 つの IP はどこへいきましたか?</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/glance">Glance [Images] (6)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/glance/FAQ_Working_with_Windows_Images/">Windows イメージの操作の FAQ</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/glance/compatible-glance-images/">Glance で使用するためにダウンロードできる正式な OpenStack 互換のイメージのリストはありますか? (CentOS、Ubuntu、など)</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/glance/disk-capacity-constraints/">ディスク容量の制約</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/glance/Image_Properties_on_Power/">Power コンピュート上の Glance イメージの最適設定</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/glance/imagesnapshot/">イメージとスナップショットの違い</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/cinder">Cinder [Block Storage] (13)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/cinder/read-only-cinder-error/">Cinder ボリュームが読み取り専用になるのは何が原因で、どのようにすれば修正できますか</a>
          </li>
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/cinder/cinder-volume-stuck/">Cinder ボリュームの停止</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/alternative_method_for_volume_encryption/">ブロック・ストレージ・ボリューム暗号化の代替方式 (Ubuntu ゲスト VM の使用)</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/Bug_Creating_Encrypted_Volumes/">Cinder による暗号化されたボリュームの作成がサポートされない</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/cinder/Managing_block_storage/">ブロック・ストレージの管理</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/cli-create-volume/">コマンド・ラインを使用したボリュームの作成</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/create-volume-from-snapshot/">インスタンスのスナップショットからのボリュームの作成はサポートされていますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/resize_cinder_volume/">Cinder ボリュームはどうすればサイズ変更できますか?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/supported_volume_types/">Cloud インスタンスでは、どのような Cinder ボリューム・タイプがサポートされますか? </a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/Ephemeral_to_Cinder/">一時ディスクから Cinder ストレージへの移動方法</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/volume_clone/">Can I enable volume full clone more than copy-on-write clone?</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/Force_snapshot_on_attached_volume/">接続されているボリュームでスナップショットを強制する方法</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/cinder/cinder-failed-connection-error/">Cinder クライアントが「ERROR: Unable to establish connection」というメッセージを返して接続できない場合はどうすればよいですか?</a>
              </li>
            
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/keystone">Keystone [Identity] (8)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/oidc-federation/">IBM Bluemix Private Cloud での OpenID Connect フェデレーション</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/saml-federation/">IBM Bluemix Private Cloud での Keystone SAML フェデレーション</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/RBAC_Definitions/">役割ベースのアクセス制御</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/Managing_Users_and_Projects/">ユーザーおよびプロジェクトの管理</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/k2k-federation/">IBM Bluemix Private Cloud での Keystone to Keystone (K2K) フェデレーション</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/tenants-security-groups-keystone/">プロジェクトおよびセキュリティー・グループ</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/keystone/custom-domains-keystone/">Keystone V3 内のカスタム・ドメイン</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/keystone/Getting_Started_with_K2K_Identity/">Keystone Federated Identity 概要</a>
          </li>
          
        
      </ul>
    </li>

    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/heat">Heat [Orchestration] (7)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/heat/Getting_Started_With_Heat/">Heat テンプレート入門</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/heat/autoscaling-with-heat/">自動スケーリングのための Heat の使用</a>
              </li>
            
          
        
          
          <li>
              <a class="page-link" href="/help-documentation/ja/heat/Deploying_apps_with_UCD/">IBM UrbanCode Deploy および IBM Bluemix Private Cloud でのアプリケーションのデプロイ</a>
          </li>
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/heat/using_heat_for_load_balancer/">サーバーにロード・バランサーをプロビジョニングするために Heat を使用</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/heat/using-ucd-ucdp/">IBM Bluemix Private Cloud での IBM Urban Code Deploy の使用</a>
              </li>
            
          
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/heat/using_heat_for_deployment/">自己署名証明書による Heat の使用</a>
              </li>
            
          
        
      </ul>
    </li>


    <li>
      <h3 class="title">
        <a  class="page-link"  href="/help-documentation/ja/ceilometer">Ceilometer [Telemetry] (1)</a>
        <a href=""  class="expand rotate" ><img src="/help-documentation/img/ja/arrow.svg" /></a>
      </h3>
      <ul  class="article__list slide-up-hidden" >
        
        
        
          
            
            
              <li class="non-featured">
                  <a class="page-link" href="/help-documentation/ja/ceilometer/compatible-glance-images/">インスタンスのスナップショットからのボリュームの作成はサポートされていますか?</a>
              </li>
            
          
        
      </ul>
    </li>

  </ul>
</div>


<article>

  <div class="page-container">

    <div class="main-content">
      <header class="post-header">

        <h1 class="post-title">
        

        

        HAProxy で処理できる最大同時接続数

        
        </h1>




        
        <div class="post-data">
          <img src='/help-documentation/img/ja/avatar.png' />
          <ul class="author--info">
            <li>
              <span class="author">by Lampros Chaidas </span>
              <span class="dot">&#9679;</span>
              <span class="date"> October 21, 2016</span>
            </li>
            <li>
              <span class="job-title"></span>
            </li>
            <li class="tags">
              
                <h4>Tags:</h4>
                  <ul class="tag--list">
                  
                    <li class="tag"><p>トラブルシューティング</p></li>
                  
                    <li class="tag"><p>haproxy</p></li>
                  
                    <li class="tag"><p>maxconn</p></li>
                  
                    <li class="tag"><p>負荷テスト</p></li>
                  
                  </ul>
              
            </li>
          </ul>
        </div>
        
      </header>

      <div class="post-content">
        <p><strong>ご留意事項:</strong> この記事は、特に OpenStack Neutron LBaaS に関連しているわけではなく、インスタンス内で実行されている HAProxy にのみ関連しています。</p>

<p>最近、お客様のロード・バランシング構成を確認していました。お客様と HAProxy 状態ページを調べているときに、「実際にサポートできる同時接続数はいくつですか」という質問が出ました。</p>

<p>バックエンド・サーバーごとの最大接続数は本当に重要なのでしょうか? この記事では、<a href="http://www.haproxy.org/">HAProxy</a> で処理できる同時接続数を判別する方法について説明します。</p>

<p>HAProxy を <strong>CentOS 6 VPS</strong> にインストールし、回答を求めるために一連のテストを実行します。別の VPS 上で、ベンチマーキング・ユーティリティーをセットアップします。</p>

<h2 id="要件">要件:</h2>

<ul>
  <li>2 台の CentOS 6.x VPS</li>
</ul>

<p>このテストで使用した VPS の仕様は以下のとおりです。</p>

<ul>
  <li>2GB RAM</li>
  <li>2 コア</li>
  <li>CentOS 6.7</li>
</ul>

<h2 id="haproxy-vps-での-haproxy-のインストール">HAProxy VPS での HAProxy のインストール:</h2>

<p>ステップ 1. 以下のように、<strong>CentOS 6</strong> 用の HAProxy <a href="https://ius.io/">IUS (Inline with Upstream Stable) repo</a> をインストールします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  yum -y install https://centos6.iuscommunity.org/ius-release.rpm
</code></pre>
</div>

<p>ステップ 2. 次に、HAProxy の最新バージョン (執筆時点では <code class="highlighter-rouge">1.6.9</code>) を取得します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  yum -y install haproxy16u &amp;&amp; chkconfig haproxy on
</code></pre>
</div>

<p>ステップ 3. 後から確認する必要が生じた場合に備えて、以下のように、デフォルトの HAproxy 構成を別の場所に移動します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg-default
</code></pre>
</div>

<p>ステップ 4. 以下のように、HAProxy からログを受け取るように <a href="http://www.rsyslog.com/">rsyslog</a> を構成します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  sed -i -- 's/#$ModLoad imudp/$ModLoad imudp/g' /etc/rsyslog.conf
  sed -i -- 's/#$UDPServerRun 514/$UDPServerRun 514/g' /etc/rsyslog.conf
  echo "\$UDPServerAddress 127.0.0.1" &gt;&gt; /etc/rsyslog.conf
  echo "local2.* -/var/log/haproxy.log" &gt;&gt; /etc/rsyslog.conf
</code></pre>
</div>

<p>上述のコマンドでは、<code class="highlighter-rouge">rsyslog</code> が UDP ポート <code class="highlighter-rouge">514</code> を listen し、<code class="highlighter-rouge">localhost</code> 接続のみに制限するように設定しています。最後の行では、HAProxy ログが <code class="highlighter-rouge">/var/log/haproxy.log</code> に送られるように設定しています。</p>

<p>ステップ 5. 以下のように、<code class="highlighter-rouge">rsyslog</code> を再起動して、変更を有効にします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  service rsyslog restart
</code></pre>
</div>

<p>ステップ 6. 新規 HAProxy 構成 <code class="highlighter-rouge">/etc/haproxy/haproxy.cfg</code> を追加します。<code class="highlighter-rouge">maxconn 20</code> の行に注意してください。<a href="https://cbonte.github.io/haproxy-dconv/1.6/configuration.html#maxconn">マニュアル・ページ</a>によると、この制限に達すると、プロキシーは接続を受け入れなくなります。つまり、この構成では、同時に <strong>20</strong> の接続までのみ許可されます。</p>

<p><code class="highlighter-rouge">fullconn 20</code> の行は何でしょうか? <a href="https://cbonte.github.io/haproxy-dconv/1.6/configuration.html#4-fullconn">マニュアル・ページ</a>では、サーバーで最大接続数を使用することになるバックエンド上の接続数と定義されています。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>global
daemon
# we need the socket for hatop statistics
stats socket /var/run/haproxy.sock mode 600 level admin
log /dev/log local4
maxconn 20

defaults
log global
timeout connect 4000
timeout client 42000
timeout server 43000

listen lampros-pool-1
bind *:80
mode http
balance roundrobin
fullconn 20
server go_http_server_1 127.0.0.1:8080 cookie go_http_server_1 check inter 2000 rise 2 fall 3

</code></pre>
</div>

<h2 id="go-言語のインストール-これは両方のサーバーで実行">Go 言語のインストール (これは両方のサーバーで実行):</h2>

<p>Go 言語を <code class="highlighter-rouge">screen</code> ユーティリティーおよび <code class="highlighter-rouge">git</code> とともにインストールします。HAProxy VPS で非常に基本的なアプリケーション・サーバーをコンパイルするため、両方のサーバーでこの言語が必要です。ベンチマーカーの VPS では、<a href="https://github.com/cmpxchg16/gobench">gobench</a> ベンチマーカー・ユーティリティーを実行できるようにするために Go が必要です。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yum -y install git screen nc
cd /tmp
wget https://storage.googleapis.com/golang/go1.7.linux-amd64.tar.gz
tar -xvf go1.7.linux-amd64.tar.gz
mv go /usr/local
export GOROOT=/usr/local/go
mkdir /root/goapps
export GOPATH=/root/goapps
export PATH=$PATH:$GOPATH/bin:$GOROOT/bin
echo export "GOPATH=/root/goapps" &gt;&gt; ~/.bashrc
echo export "export PATH=$PATH:$GOPATH/bin:$GOROOT/bin" &gt;&gt; ~/.bashrc
</code></pre>
</div>

<h2 id="haproxy-サーバーで以下のようにgo-を使用して基本的なアプリケーションサーバーをセットアップします">HAProxy サーバーで、以下のように、Go を使用して基本的なアプリケーション・サーバーをセットアップします。</h2>

<p>ステップ 1. 以下のように、<code class="highlighter-rouge">/root/slowserver</code> というディレクトリーを作成します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  mkdir -pv /root/slowserver
</code></pre>
</div>

<p>ステップ 2. その中に、以下の内容が含まれた <code class="highlighter-rouge">/root/slowserver/slowserver.go</code> というファイルを追加します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>package main

import (
    "fmt"
    "net/http"
    "time"
)

func slow_handler(w http.ResponseWriter, r *http.Request) {
    time.Sleep(3000 * time.Millisecond)
    fmt.Fprintf(w, "I'm slooooow")
}

func fast_handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "I'm FAST!!!!")
}

func main() {
    http.HandleFunc("/fast", fast_handler)
    http.HandleFunc("/slow", slow_handler)
    http.ListenAndServe(":8080", nil)
}
</code></pre>
</div>

<p>ステップ 3. 以下のように、<code class="highlighter-rouge">go build</code> を使用してこのファイルをコンパイルします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  cd /root/slowserver
  go build
</code></pre>
</div>

<p>ステップ 4. 切り離された screen セッションで slowserver を開始し、バックグラウンドにとどまるようにします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  screen -d -m -t go_slowserver /root/slowserver/slowserver
</code></pre>
</div>

<p>ステップ 5. <code class="highlighter-rouge">netstat -ntlp | grep slowserver</code> を使用して、実行中であることを確認します。listen しているポートとプロセス ID が表示されます。私の場合、以下の出力が得られました。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  netstat -ntlp | grep slowserver
  tcp        0      0 :::8080                     :::*                        LISTEN      5204/slowserver
</code></pre>
</div>

<h2 id="haproxy-サーバーで-hatop-をセットアップします">HAProxy サーバーで HATop をセットアップします。</h2>

<p>ステップ 1. HAProxy をモニターできるように、以下のように、<a href="http://feurix.org/projects/hatop/">HATop</a> をダウンロードしてインストールします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  cd /tmp
  wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/hatop/hatop-0.7.7.tar.gz
  tar -xzf hatop-0.7.7.tar.gz
  cd hatop-0.7.7
  install -m 755 bin/hatop /usr/local/bin
  install -m 644 man/hatop.1 /usr/local/share/man/man1
  gzip /usr/local/share/man/man1/hatop.1
</code></pre>
</div>

<p>ステップ 2. 以下のように、HAProxy を開始します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  service haproxy start
</code></pre>
</div>

<p>ステップ 3. 以下のように、HAtop を開始します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  hatop -s /var/run/haproxy.sock
</code></pre>
</div>

<p>ステップ 4. 次に、以下の 1 行のコマンドを使用して、バックエンド・サーバー <strong>go_http_server_1</strong> の状況を HAProxy に問い合わせます。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  echo "show stat" | nc -U /var/run/haproxy.sock | awk -F, '/go_http_server/{print $18}'
</code></pre>
</div>

<p>以下の出力が得られます。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  稼働中
</code></pre>
</div>

<h2 id="テストを実行する-vps-で以下を実行します">テストを実行する VPS で、以下を実行します。</h2>

<p>以下のように、<a href="https://github.com/cmpxchg16/gobench">gobench</a> ベンチマーカー・ユーティリティーをダウンロードします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  go get github.com/cmpxchg16/gobench
</code></pre>
</div>

<h2 id="バックエンドサーバーごとの最大接続数が本当に重要なのかを調べる負荷テスト-人為的な遅延なし">バックエンド・サーバーごとの最大接続数が本当に重要なのかを調べる負荷テスト (人為的な遅延なし)</h2>

<p>最初のテストでは、<code class="highlighter-rouge">fullconn</code> 設定が結果に影響するかどうかを判別しようとします。1 回目の実行では、<code class="highlighter-rouge">fullconn</code> を <code class="highlighter-rouge">20</code> に設定し、2 回目の実行では、<code class="highlighter-rouge">1</code> に設定します。<code class="highlighter-rouge">20</code> の高速クライアント (人為的な遅延なし) を使用した、<code class="highlighter-rouge">30</code> 秒分のベンチマーキング用にテストを調整します。以下のようにします。</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> fast</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/fast -c 20 -t 30
</code></pre>
</div>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 20 clients
Waiting for results...

Requests:                           627867 hits
Successful requests:                627867 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:            20928 hits/sec
Read throughput:                   2699828 bytes/sec
Write throughput:                  1841801 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>次に、再度実行する前に、HAProxy の構成を変更し、<code class="highlighter-rouge">fullconn</code> を <code class="highlighter-rouge">1</code> に設定します。<code class="highlighter-rouge">sed</code> を使用してこのタスクを実行してから、HAProxyを再ロードします。以下のようにします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sed -i -- 's/fullconn 20/fullconn 1/g' /etc/haproxy/haproxy.cfg
/etc/init.d/haproxy reload
</code></pre>
</div>

<p>要約すると、以下のとおりです。</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 1</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> fast</li>
</ul>

<p>次に、以下のように、同じテストを再度実行します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/fast -c 20 -t 30
</code></pre>
</div>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/fast -c 20 -t 30
Dispatching 20 clients
Waiting for results...

Requests:                           527141 hits
Successful requests:                527141 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:            17571 hits/sec
Read throughput:                   2266727 bytes/sec
Write throughput:                  1546353 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>お分かりのように、1 回目のテストでは 20928 ヒット/秒でしたが、2 回目のテストでは 17571 ヒット/秒でした。では、今度はアプリケーション・サーバーが低速で、毎回応答するのに 3 秒かかった場合はどうなるでしょうか?</p>

<h2 id="バックエンドサーバーごとの最大接続数が本当に重要なのかを調べる負荷テスト-3-秒の人為的な遅延">バックエンド・サーバーごとの最大接続数が本当に重要なのかを調べる負荷テスト (3 秒の人為的な遅延)</h2>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p>開始する前に、以下のように、<code class="highlighter-rouge">fullconn</code> を <code class="highlighter-rouge">20</code> に戻します。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sed -i -- 's/fullconn 1/fullconn 20/g' /etc/haproxy/haproxy.cfg
/etc/init.d/haproxy restart
</code></pre>
</div>

<p>以下のように、再度テストします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
</code></pre>
</div>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
Dispatching 20 clients
Waiting for results...

Requests:                              180 hits
Successful requests:                   180 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                      586 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>以下のように、<code class="highlighter-rouge">fullconn</code> を <code class="highlighter-rouge">1</code> に戻し、再度テストします。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sed -i -- 's/fullconn 20/fullconn 1/g' /etc/haproxy/haproxy.cfg
/etc/init.d/haproxy restart
</code></pre>
</div>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 1</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
</code></pre>
</div>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 20 clients
Waiting for results...

Requests:                              180 hits
Successful requests:                   180 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                      586 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<h2 id="結論-バックエンドサーバーごとの最大接続数が本当に重要なのかを調べる負荷テスト">結論: バックエンド・サーバーごとの最大接続数が本当に重要なのかを調べる負荷テスト</h2>

<p>回答は「はい」でした。重要であるが、サーバーが高速な場合のみという条件付きでした。低速サーバーでは、結果に差はありませんでした。</p>

<h2 id="haproxy-で処理できる同時接続数を判別する負荷テスト">HAProxy で処理できる同時接続数を判別する負荷テスト</h2>

<p>次に、HAProxy で処理できる同時接続数を確認します。開始する前に、HAProxy に関する以下の 1 つの基本的な詳細を忘れないようにしましょう。<a href="https://cbonte.github.io/haproxy-dconv/1.6/configuration.html#1.1">デフォルトでは、HAProxy は、持続接続についてキープアライブ・モードで動作します。つまり、接続ごとに、それぞれの要求と応答を処理し、応答の終了から新規要求の開始までの間、両側で接続をアイドルのままにします。</a></p>

<p>この記述は、長期実行接続は、短期存続接続より大きい影響をサーバーに及ぼすことを意味します。そのため、アプリケーション・サーバーの「slow」(低速) 機能に対してテストを実行します。</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 20</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 20 -t 30
</code></pre>
</div>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 20 clients
Waiting for results...

Requests:                              180 hits
Successful requests:                   180 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                      586 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p><code class="highlighter-rouge">6 hits/sec</code> と表示され、エラーは報告されませんでした。次に、クライアント数を 5 倍 (100) にして、再試行します。</p>

<ul>
  <li><strong>maxconn</strong> 20</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
</code></pre>
</div>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Dispatching 100 clients
Waiting for results...

Requests:                              266 hits
Successful requests:                   180 hits
Network failed:                         86 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:                6 hits/sec
Read throughput:                       774 bytes/sec
Write throughput:                     1120 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>引き続き <code class="highlighter-rouge">6 hits/sec</code> ですが、今回はエラーも発生しました。エラーは、HAProxy 構成が制限に達したことを意味します。これは、1 秒当たりのヒット数が増加せず、同時にエラーを取得しているためです。同じ数のクライアント (100) を使用するが、<code class="highlighter-rouge">maxconns</code> を 2 倍にするとどうなるかを見てみましょう。</p>

<ul>
  <li><strong>maxconn</strong> 40</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              426 hits
Successful requests:                   360 hits
Network failed:                         66 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               12 hits/sec
Read throughput:                      1548 bytes/sec
Write throughput:                     1630 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>以前のテストから予想されるように、<code class="highlighter-rouge">fullconn</code> は実際、制限を課していませんでした。<code class="highlighter-rouge">maxconns</code> を 2 倍にすることで、ちょうど 2 倍のヒット率 (<code class="highlighter-rouge">12 hits/sec</code>) になりました。ただし、引き続きエラーが発生しました。これは、HAProxy 構成がまだ制限を超えていることを意味します。</p>

<p><code class="highlighter-rouge">maxconns</code> を再度増加し、今回は <code class="highlighter-rouge">60</code> にします。以下のようにします。</p>

<ul>
  <li><strong>maxconn</strong> 60</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              595 hits
Successful requests:                   540 hits
Network failed:                         55 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               18 hits/sec
Read throughput:                      2322 bytes/sec
Write throughput:                     2179 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<p>お分かりのように、<code class="highlighter-rouge">maxconn</code> の制限を増加するたびに、<code class="highlighter-rouge">hits/sec</code> が線形に増加しています。エラーが発生しなくなるまで、続けてみましょう。</p>

<ul>
  <li><strong>maxconn</strong> 80</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              760 hits
Successful requests:                   720 hits
Network failed:                         40 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               24 hits/sec
Read throughput:                      3096 bytes/sec
Write throughput:                     2698 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<ul>
  <li><strong>maxconn</strong> 100</li>
  <li><strong>fullconn</strong> 20</li>
  <li><strong>seconds</strong> 30</li>
  <li><strong>connections</strong> 100</li>
  <li><strong>fast/slow</strong> slow</li>
</ul>

<p><strong>結果:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gobench -u http://10.42.226.10/slow -c 100 -t 30
Dispatching 100 clients
Waiting for results...

Requests:                              900 hits
Successful requests:                   900 hits
Network failed:                          0 hits
Bad requests failed (!2xx):              0 hits
Successful requests rate:               30 hits/sec
Read throughput:                      3870 bytes/sec
Write throughput:                     2933 bytes/sec
Test time:                              30 sec
</code></pre>
</div>

<h2 id="結論-haproxy-で処理できる同時接続数を判別する負荷テスト">結論: HAProxy で処理できる同時接続数を判別する負荷テスト</h2>

<p>上述の実験から導き出せる結論は、以下のとおりです。能力 (HAProxy に接続されるクライアントの最大数) をテストするには、TCP 接続を開くが、長期間 (3 秒) その接続を開いたままにするサーバーを使用する必要があります。これは、サーバーの高速性をテストする場合 (プッシュできるトラフィックが増えれば増えるほど良い結果が得られる) と逆です。</p>

<p>2 つ目の結論としては、各要求を処理するには、最大接続数 (<code class="highlighter-rouge">maxconn</code>) は、要求レート (例えば、100 クライアント) * 時間 (3 秒) より大きい必要があります。</p>

<p>例:</p>

<p><code class="highlighter-rouge">maxconn</code>=100*3 =&gt; <code class="highlighter-rouge">maxconn</code>=300</p>

<h2 id="出典">出典:</h2>

<ul>
  <li><a href="https://www.percona.com/blog/2014/10/03/haproxy-give-me-some-logs-on-centos-6-5/">Percona - HAProxy: Give me some logs on CentOS  6.5!</a></li>
  <li><a href="http://www.loadbalancer.org/uk/blog/setting-up-haproxy-with-transparent-mode-on-centos-6-x">Setting up HAProxy with Transparent Mode on Centos 6.x</a></li>
  <li><a href="https://golang.org/doc/articles/wiki/">The Go Programming Language - Writing Web Applications</a></li>
  <li><a href="http://unix.stackexchange.com/a/267794">Stack Exchange - Run script in a screen</a></li>
  <li><a href="http://tecadmin.net/install-go-on-centos/">TecAdmin.net - How to Install Go 1.7 on CentOS/RHEL 7/6/5</a></li>
  <li><a href="http://feurix.org/projects/hatop/">Feurix Free Open Source Projects - HATop</a></li>
  <li><a href="http://www.serverlab.ca/tutorials/linux/network-services/monitoring-haproxy-using-hatop/">Serverlab - Monitoring HAProxy using HATOP</a></li>
  <li><a href="https://github.com/cmpxchg16/gobench">Github.com - GoBench -  HTTP/HTTPS load testing and benchmarking tool</a></li>
</ul>

      </div>
    </div>

  </div>
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="footer__wrapper--light">

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Products</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="nav--item__link">Bluemix Private Cloud</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-local" class="nav--item__link">Private Cloud Local</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-contact-us" class="nav--item__link">Sales</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-faq" class="nav--item__link">FAQs</a>
      </li>
    
    </ul>

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Our Story</a>
      </li>
 <li class="footer--nav__item">
        <a href="https://github.com/blueboxgroup?cm_mc_uid=04946053248414876234663&cm_mc_sid_50200000=1489010497" class="nav--item__link">On GitHub</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://blueboxstatus.com/" class="nav--item__link">System Status</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://support.bluebox.net/" class="nav--item__link">Support</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://support.bluebox.net/" class="nav--item__link">Box Panel</a>
      </li>
    </ul>

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Resources
        </a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud">Case Studies</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="nav--item__link">Videos</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="nav--item__link">News</a>
      </li>
    </ul>

    <ul class="footer--nav">
      <li class="footer--nav__header">
        <a href="hhttps://www.ibm.com/blogs/bluemix/">Recent Blog Posts</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/07/the-power-of-openstack/" class="nav--item__link">The Power of OpenStack</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/08/blue-box-storage-models-explained/" class="nav--item__link">IBM Bluemix Private Cloud Storage Models</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.blueboxcloud.com/insight/blog-article/github-ibm-com-running-on-blue-box" class="nav--item__link">IBM Github Runs on Bluemix Private Cloud</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/10/building-up-to-openstack/" class="nav--item__link">Building up to OpenStack</a>
      </li>
      <li class="footer--nav__item">
        <a href="https://www.ibm.com/blogs/bluemix/2016/07/keystone-to-keystone-federated-identity-on-blue-box-cloud/" class="nav--item__link">Get Started with Keystone Federation</a>
      </li>
    </ul>
  </div>
  <div class="footer__wrapper--dark">
    <ul class="footer--list">
      <li class="list--item">
        <a href="https://www.facebook.com/BlueBoxGroup/" class="list--item__link">Facebook</a>
      </li>
      <li class="list--item">
        <a href="https://twitter.com/bluebox?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" class="list--item__link">Twitter</a>
      </li>
      <li class="list--item">
        <a href="https://www.linkedin.com/company/blue-box-group" class="list--item__link">LinkedIn</a>
      </li>
      <li class="list--item">
        <a href="https://plus.google.com/+BlueBoxSeattle/posts" class="list--item__link">Google +</a>
      </li>
      <li class="list--item">
        <a href="https://github.com/blueboxgroup" class="list--item__link">GitHub</a>
      </li>
    </ul>

    <ul class="footer--list">
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/private-cloud-contact-us" class="list--item__link">Contact</a>
      </li>
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="list--item__link">Legal</a>
      </li>
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="list--item__link">Privacy Policy</a>
      </li>
      <li class="list--item">
        <a href="https://www.ibm.com/cloud-computing/bluemix/bluemix-private-cloud" class="list--item__link">Terms and Conditions</a>
      </li>

    </ul>
  </div>
  <div class="footer__wrapper--black">
    <p>
        &copy; 2017 IBM Bluemix
    </p>
  </div>
</footer>



    <script src="/help-documentation/js/vendor/simple-jekyll-search.js" type="text/javascript"></script>


    <script>
        SimpleJekyllSearch({
          searchInput: document.getElementById('search-input'),
          resultsContainer: document.getElementById('results-container'),
          json: '/help-documentation/search.json',
          searchResultTemplate: '<li class="search-item"><a href="{url}" class="item-title">{title}</a><ul class="tag--list">{tags}</ul></li>'
        });
    </script>
  <script src="/help-documentation/js/scripts.js"></script>

  </body>

</html>
